(function(e){var t,a={init:function(){a.ready()},ready:function(){t=e("#entire_form").DataTable({columnDefs:[{orderable:!1,className:"select-checkbox",targets:0}],select:{style:"os",selector:"td:first-child"},order:[[1,"DESC"]]}),e("#select-form").on("change",function(){var t=e(this).val();if(t){if("-"==t)return!1;window.location="?page=entire-codex-forms&form="+t}return!1}),e(".check-all").on("click",function(){var a=t.rows({search:"applied"}).nodes();e('input[type="checkbox"]',a).prop("checked",this.checked)}),e("#entire_form tbody").on("change",'input[type="checkbox"]',function(){if(!this.checked){var t=e(".check-all").get(0);t&&t.checked&&"indeterminate"in t&&(t.indeterminate=!0)}}),e(".action_entire").on("click",function(n){n.preventDefault();var i=e("#form_id").val(),o=e("#actions").val(),r=t.$('input[type="checkbox"]').serialize();if(""===o||""===r)return!1;a.bulk_action(i,o,r)}),a.search_by_date(),e(".view-entry").on("click",function(){var t=e(this).data("entry-id");a.entry_view(t)}),e(".delete-entry").on("click",function(){var t=e(this).data("entry-id");a.delete_entry(t)}),e(".modal-view .actions .entry-edit").on("click",function(){var t=e(this).data("entry-id");a.entry_edit(t)}),e(".modal-edit .actions .entry-view").on("click",function(){var t=e(this).data("entry-id");a.entry_view(t)}),e(".modal-edit .actions .entry-save").on("click",function(t){t.preventDefault();var n=e(this).data("entry-id"),i=JSON.stringify(e(".edit_entry_value").serializeArray());a.entry_save_value(n,i)})},search_by_date:function(){var a,n;a=new DateTime(e("#min"),{format:"YYYY-MM-DD"}),n=new DateTime(e("#max"),{format:"YYYY-MM-DD"}),e.fn.dataTable.ext.search.push(function(e,t,i){var o=a.val(),r=n.val(),c=new Date(t[2]);return null===o&&null===r||null===o&&c<=r||o<=c&&null===r||o<=c&&c<=r}),e("#min, #max").on("change",function(){t.draw()})},entry_view:function(t){var a=e("#form_id").val(),n={form_id:a,entry_id:t,action:"load_entry_value"};e.post(codex_admin.ajax_url,n,function(a){if(a.success){e(".modal-view").modal("show"),e(".modal-view .header").html("Entry ID: "+t);var n="<thead><tr><th>Field Name</th><th>Value</th></tr></thead>";a.data.forEach(function(e){var t=e.name;""===e.name&&(t=e.field_id),n+="<tr>",n+="<td>"+t+" ("+e.type+")</td>",n+="<td>"+e.value+"</td>",n+="</tr>"}),e(".modal-view .content .table").html(n),e(".modal-view .actions .entry-edit").attr("data-entry-id",t)}else console.log(e(this))}).fail(function(e,t,a){console.log(e.responseText)})},delete_entry:function(t){var a=e("#form_id").val(),n={form_id:a,select:"id="+t,action:"delete_entry"};e.post(codex_admin.ajax_url,n,function(e){e.success?"delete"==e.data.action&&(alert("Delete Selected success."),location.reload()):alert("Selected Can't not action.")})},entry_edit:function(t){var a=e("#form_id").val(),n={form_id:a,entry_id:t,action:"load_entry_value"};e.post(codex_admin.ajax_url,n,function(a){if(a.success){e(".modal-edit").modal("show"),e(".modal-edit .header").html("Entry ID: "+t);var n="<thead><tr><th>Field Name</th><th>Value</th></tr></thead>";a.data.forEach(function(e){var t=e.name;""===e.name&&(t=e.field_id),n+="<tr>",n+="<td>"+t+"</td>",n+="<td><input type='text' name='"+e.field_id+"' value='"+e.value+"'</td>",n+="</tr>"}),e(".modal-edit .content .table").html(n),e(".modal-edit .actions .entry-view").attr("data-entry-id",t),e(".modal-edit .actions .entry-save").attr("data-entry-id",t)}})},entry_save_value:function(t,n){var i={entry_id:t,entry_value:n,action:"save_edit_entry"};e.post(codex_admin.ajax_url,i,function(e){e.success?(alert("Save value success"),a.entry_view(t)):alert("Save value not success")}).fail(function(e,t,a){console.log(e.responseText)})},bulk_action:function(t,a,n){var i={form_id:t,select:n,action:a+"_entry"};e.post(codex_admin.ajax_url,i,function(e){e.success?"delete"==e.data.action?(alert("Delete Selected success."),location.reload()):e.data.url&&(window.location=e.data.url):alert("Selected Can't not action.")}).fail(function(e,t,a){console.log(e.responseText)})}};a.init()})(jQuery);