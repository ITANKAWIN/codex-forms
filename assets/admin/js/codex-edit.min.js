(function(e){var n={init:function(){e(n.ready)},ready:function(){n.jQueryui(),n.field_ots(),n.load_on_action(),e("#add-row").click(function(){n.addRow_panel()}),e(".layout-panel").on("click",".delete-row",function(t){t.preventDefault(),n.deleteRow_panel(e(this))}),e(".layout-panel").on("mouseenter",".layout-row",function(t){n.showTool_panel(e(this))}),e(".layout-panel").on("mouseleave",".layout-row",function(n){e(".tools-column").remove()}),e(".layout-panel").on("click",".split-column",function(t){n.splitColumn_panel(e(this))}),e(".layout-panel").on("click",".join-column",function(t){n.joinColumn_panel(e(this))}),e(".layout-panel").on("mouseenter",".field-row",function(t){n.showTool_field(e(this))}),e(".layout-panel").on("mouseleave",".field-row",function(n){e(".config-field").remove(),e(".delete-field").remove()}),e(".layout-panel").on("click",".config-field",function(t){n.config_field(e(this))}),e(".layout-panel").on("click",".delete-field",function(t){if(confirm("Are you sure you want to delete?")){var o=e(this).parent().data("field-id");e("[data-field-id='"+o+"']").remove(),n.field_ots()}}),e(".save_form").on("click",function(e){e.preventDefault(),n.save_form()}),e(".config-form-label").keyup(function(){n.fieldconfig_label(e(this))}),e(".config-form-placeholder").keyup(function(){n.fieldconfig_placeholder(e(this))}),e(".config-form-text-button").keyup(function(){n.fieldconfig_text_button(e(this))}),e(".config-form-align-button").on("change",function(){n.fieldconfig_align_button(e(this))}),e(".config-fields").on("click",".add",function(t){n.fieldSelectOptionAdd(t,e(this))}),e(".config-fields").on("click",".remove",function(t){n.fieldSelectOptionRemove(t,e(this))}),e(".setting-form").on("click",function(){e(".modal-setting").modal("show")}),e(".select_media").on("click",function(n){n.preventDefault();var t,o=e(this).data("id");t?t.open():(t=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image"},multiple:!1}),t.on("select",function(){attachment=t.state().get("selection").first().toJSON(),e("#"+o).attr("src",attachment.url),e("input[name='fields["+o+"][image]']").val(attachment.url)}),t.open())})},jQueryui:function(){e(".layout-column, .panel-row").sortable({connectWith:".layout-column",items:".field-row",cursor:"move",placeholder:"field-highlight",stop:function(e,t){t.item.removeAttr("style"),n.buildLayout(),n.field_ots()},receive:function(t,o){var i=e("#form_id"),a=Math.floor(9e5*Math.random())+1e5,l=o.item;if(null!=o.helper&&(l=o.helper),l.attr("data-field-id"))n.buildLayout(),n.field_ots(),n.load_on_action();else{var d=l.data("field-type"),r={id:i.val(),field_id:a,action:"codex_new_field_"+d};e.post(codex_admin.ajax_url,r,function(t){t.success?(l.attr("data-field-id",a),l.html(t.data.preview),l.append(t.data.position),e(".config-fields").append(t.data.config),n.buildLayout(),n.field_ots(),n.load_on_action()):console.log(t)}).fail(function(e,n,t){console.log(e.responseText)})}}}),e(".field-item").draggable({connectToSortable:".layout-column",cursor:"grabbing",placeholder:!0,start:function(e,n){n.helper.addClass("ui segment").css("width","500px").css("font-size","20px").css("text-align","center")},helper:function(){var n=e(this),t=n.data("field-type"),o=e('<div class="field-row"></div>'),i=n.html();return o.html(i).css("height","70px").attr("data-field-type",t)},containment:"document"})},field_ots:function(){var n=e('select[name*="setting[template]"]').val();if("login"==n)n=codex_admin.field_login;else{if("register"!=n)return;n=codex_admin.field_register}e.each(n,function(n,t){var o=e(".layout-column").find('*[data-field-type="'+t.type+'"]'),i=e(".item").find('*[data-field-type="'+t.type+'"]');o.length>0?i.draggable("disable"):i.draggable("enable")})},load_on_action:function(){e(".codex-rating").rating("setting","clearable",!0),e(".ui.dropdown").dropdown(),e(".ui.checkbox").checkbox()},addRow_panel:function(){e(".layout-panel").append(codex_admin.element_addRow),n.buildLayout(),n.jQueryui()},deleteRow_panel:function(t){var o=e(t).closest(".layout-row"),i=o.find(".field-row");if(i.length){if(!confirm("Are you sure to delete."))return;i.each(function(n,t){var o=e(t).data("field-id");e('[data-field-id="'+o+'"]').remove()})}o.slideUp(200,function(){e(this).remove(),n.buildLayout(),n.field_ots()})},showTool_panel:function(n){var t=e(n);t.children().children().first().append('<div class="delete-row tools-column"><i class="dashicons dashicons-remove"></i></div>'),t.children().children().not(":first").prepend('<div class="join-column tools-column"><i class="dashicons dashicons-leftright"></i></div>'),t.children().children().each(function(n,t){var o=e(t),i=o.width()/2-5;o.parent().hasClass("col-1")||(o.prepend('<div class="split-column tools-column"><i class="dashicons dashicons-image-flip-horizontal"></i></div>'),o.find(".split-column").css("left",i))})},splitColumn_panel:function(t){var o=e(t).parent().parent(),i=o.attr("class").split("-"),a=e("<div>").insertAfter(o),l=Math.ceil(i[1]/2),d=Math.floor(i[1]/2);i[1]=l,o.attr("class",i.join("-")),i[1]=d,a.addClass(i.join("-")).append('<div class="layout-column">'),e(t).remove(),e(".tools-column").remove(),n.jQueryui(),n.buildLayout()},joinColumn_panel:function(t){var o=e(t).parent().parent(),i=o.prev(),a=i.attr("class").split("-"),l=o.attr("class").split("-");a[1]=parseFloat(a[1])+parseFloat(l[1]),o.find(".layout-column").contents().appendTo(i.find(".layout-column")),i.attr("class",a.join("-")),o.remove(),n.buildLayout(),e(".tools-column").remove()},showTool_field:function(n){e(n).append(codex_admin.config_field),e(n).append(codex_admin.delete_field)},config_field:function(n){var t=e(n).parent().data("field-id"),o=e(n).parent();e("#sidebar").hasClass("active")&&e("#sidebar").toggleClass("active"),e("[data-tab=config]").trigger("click"),e(".wrapper-instance-pane").hide(),o.hasClass("config-open")?e(".config_field_"+t).show():(e(".field-row").removeClass("config-open"),o.addClass("config-open"),e(".config_field_"+t).show())},save_form:function(){var n=e("#form_name"),t=e("#form_id"),o=e("#nonce"),i=e("#form_status");e(".save_form").html("<strong class='saving'>Saving<span>.</span><span>.</span><span>.</span></strong>");var a={title:n.val(),id:t.val(),nonce:o.val(),status:i.val(),setting:JSON.stringify(e("#setting_form").serializeArray()),data:JSON.stringify(e("#panel").serializeArray()),action:"save_form"};e.post(codex_admin.ajax_url,a,function(n){n.success?(e(".save_form").html("<strong>Saved</strong>"),setTimeout(function(){e(".save_form").html("<strong>Save</strong>")},5e3)):e(".save_form").html("<strong>Save is not successful</strong>")}).fail(function(e,n,t){console.log(e.responseText)})},buildLayout:function(){var t=e(".layout-panel"),o=0;t.each(function(n,t){var i=e(t),a=i.find("input[name='panels']"),l=i.find(".layout-row"),d=[];l.each(function(n,t){var i=e(t),a=i.children(),l=[];o+=1,a.each(function(n,t){span=e(t).attr("class").split("-"),l.push(span[1]);var i=e(t).find(".panel");i.length&&i.each(function(t,i){var a=e(i);a.val(o+":"+(n+1)).removeAttr("disabled")})}),d.push(l.join(":"))}),a.val(d.join("|"))}),n.save_form()},fieldconfig_label:function(n){var t=n.parent().parent().parent().parent().parent().data("field-id"),o=n.val();e("label[id="+t+"]").text(o)},fieldconfig_placeholder:function(n){var t=n.parent().parent().parent().parent().parent().data("field-id"),o=n.val();e("input[id="+t+"]").attr("placeholder",o)},fieldconfig_text_button:function(n){var t=n.parent().parent().parent().parent().parent().data("field-id"),o=n.val();e("button[id="+t+"]").text(o)},fieldconfig_align_button:function(n){var t=n.parent().parent().parent().parent().data("field-id"),o=n.children().val();e("button[id="+t+"]").parent().attr("style","text-align:"+o)},fieldSelectOptionAdd:function(n,t){n.preventDefault();var o=e(t),i=o.parent(),a=i.parent().parent().parent().parent().data("field-id"),l=e(".config_field_"+a).find("input[name='fields["+a+"][next_option_id]']"),d=l.val();$choice=i.clone().insertAfter(i),$choice.find("input[type=text]").val("").attr("name","fields["+a+"][options]["+d+"]"),d++,l.val(d)},fieldSelectOptionRemove:function(n,t){n.preventDefault();var o=e(t),i=o.parent(),a=i.parent().find(".ui").length;confirm(codex_admin.confirm_remove_option)&&(1===a?alert(codex_admin.confirm_remove_option_alert):i.remove())}};n.init()})(jQuery);